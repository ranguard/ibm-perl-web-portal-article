<h2>Summary:</h2>
<p>
<em>Use Perl as a simple and powerful framework for your web site; this article will demonstrate how easy it is to get going and then customise a Plack application for your own needs.</em>
</p><p>
Perl has been through a revolution over the last few years - 'Modern Perl', based on experienced and effective Perl 5 programmers knowledge, it is about using the languages idioms and taking advantage of the best of <a href="http://search.cpan.org">CPAN</a>.
</p><p>
We will be demonstrating how to create a web site using <a href="http://search.cpan.org/dist/Plack/">Plack</a>, a 'Moden Perl' tool. Most Perl frameworks work with (or are migrating to) Plack, therefor it will be easy to integrate one of those later should you want to.
</p><p>
Plack is Perl superglue for web frameworks and web servers. Plack sits between your code (whether you use a web framework or not) and the web server (Apache, Starman, etc). This means that you (and your framework) do not need to worry about specifics of a web server, and vice-versa.
</p><p>
Lets get you setup... we are going to use <a href="http://search.cpan.org/dist/App-cpanminus/bin/cpanm">cpanm</a> (from <a href="http://search.cpan.org/dist/App-cpanminus/">App::cpanminus</a>) to download and install modules into your <a href="http://search.cpan.org/dist/local-lib/lib/local/lib.pm">local::lib</a> (so you do not need root access)
</p><p>
<h2>Initial setup:</h2>
<pre>
# archive of any existing cpan configuration
mv ~/.cpan ~/.cpan_original
 
# Then one of the following:

# if you can run wget
wget -O - http://cpanmin.us/ | perl - local::lib App::cpanminus && echo 'eval $(perl -I$HOME/perl5/lib/perl5 -Mlocal::lib)' >> ~/.bashrc && . ~/.bashrc
 
# OR if you can run curl
curl -L http://cpanmin.us/ | perl - local::lib App::cpanminus && echo 'eval $(perl -I$HOME/perl5/lib/perl5 -Mlocal::lib)' >> ~/.bashrc && . ~/.bashrc
 
# otherwise, download the contents of http://cpanmin.us to a file called cpanmin.us, make it executable and then run: 
./cpanmin.us local::lib App::cpanminus && echo 'eval $(perl -I$HOME/perl5/lib/perl5 -Mlocal::lib)' >> ~/.bashrc && . ~/.bashrc
</pre>
</p><p>
<h2>Setting up Plack</h2>
<p>
<pre>
cpanm Plack
</pre>
The <code>perl5</code> folder in your home directory will now have all the modules you need.
The next step is to create a .psgi configuration file which will allow us to return a
web page.
</p>
<p>

<a href="psgi_examples/1.psgi">1.psgi</a>
<pre>
    #!/usr/bin/env perl

    # Tell Perl where our lib is (ALWAYS use this)
    use lib "$ENV{HOME}/perl5/lib/perl5";

    # local::lib sets everything up correctly from  (ALWAYS use this)
    use local::lib;

    # ensure we declare everything correctly (ALWAYS use this)
    use strict;

    # Give us diagnostic warnings where possible (ALWAYS use this)
    use warnings;

    # Code to run our application
    use Plack::Runner;

    # Code to validate that our application is configured correctly
    use Plack::Middleware::Lint;

    # A basic app
    my $app = sub {
        my $env = shift;
        return [
            200,    # HTTP Status code
            [ 'Content-Type' => 'text/html' ],    # HTTP Headers,
            ["All is good"]                       # Content
        ];
    };

    # Create a runner object
    my $runner = Plack::Runner->new;

    # Pass in command line arguments (useful when developing)
    $runner->parse_options(@ARGV);

    # Actually run the application
    $runner->run($app);
</pre>
Save this to a file, called 1.psgi, then use the <a href="http://search.cpan.org/dist/Plack/scripts/plackup">plackup</a> command to start your web server from the command line as follows: 
<pre>
    plackup 1.psgi
</pre>
You will see:
<pre>
    HTTP::Server::PSGI: Accepting connections at http://SERVER_IP:5000/
</pre>
Using your web browser, go to http://SERVER_IP:5000/, if you are developing
on your desktop computer then <a href="http://localhost:5000/">http://localhost:5000/</a> will work.
You should now see a page with 'All is good'. In fact if you go to <em>any</em> page this is what you will see,
e.g. <a href="http://localhost:5000/any_page.html">http://localhost:5000/any_page.html</a> because
we are always returning this, irrespective of the request.
</p><p>
You will notice that on the command line you can see the access logs for the web server, this
is because Plack defaults to development mode and turns on a few extra middleware layers for you,
specifically AccessLog, StackTrace and Lint.
</p><p>
To see StackTrace in operation comment out line 27 of 1.psgi by adding a hash (#) in front of it:
<pre>
    # ["All is good"]                       # Content
</pre>
Restart your plackup command (type Ctrl+C to stop the process, then run <code>plackup 1.psgi</code> to start it).
Now in your web browser go to <a href="http://localhost:5000/">http://localhost:5000/</a> again and you will see
a StackTrace of the error. Note the main error message at the top of the page "response needs to be 3 element array, or 2 element in streaming". You can then follow each step of the trace, click on the 'Show function arguments' and 'Show lexical variables' links under any section of the trace to help debug the issue.
</p>
<p>
Remove the # and restart, so we have a working .psgi file again.
</p>
<h2>Development</h2>
<p>
There are several command line arguments to the plackup command, running <code>perldoc plackup</code> command will
show you the documentation. The most used is '-r' or '--reload' this tells plackup to monitor you .psgi file
(if you have a 'lib' directory along side your .psgi file it will also be monitored).
<pre>
    plackup -r 1.psgi
</pre>



TODO:
<pre>
- Show serving static files
- ErrorDocumentation
- Deflate
- TemplateToolkit
</pre>
</p>
<h2>Deployment</h2>
<p>
<pre>
    cpanm Task::Plack
    Apache/Starman
    Reverse-Proxy (Perlbal or nginx)
</pre>

</p>
<h2>Further reasources</h2>
<p>
Perl has a vast number of modules available for use on
<a href="http://search.cpan.org/">CPAN</a>. The only real problem
being to work out which are best to use. A good place to start is
 <a href="http://search.cpan.org/dist/Task-Kensho/">Task::Kensho</a>
 which recommends current best practices.
</p><p>






</p><p>

<a href="http://www.perl.org/about/whitepapers/">Perl Whitepapers</a>
</p>
